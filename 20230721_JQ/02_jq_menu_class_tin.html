<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .self-red {
            background-color: lightpink;
        }
    </style>
</head>

<body>
    <!-- <div class="container mt-5">
        <div class="row">
            <div class="col">
                <div class="d-grid gap-2">
                    <button class="itemBtn btn btn-primary" type="button" id="item1Btn" data-stock-name="拿鐵"
                        data-price=140>
                    </button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button class="itemBtn btn btn-success" type="button" id="item2Btn" data-stock-name="花茶"
                        data-price=110>
                    </button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button class="itemBtn btn btn-danger" type="button" id="item3Btn" data-stock-name="星冰樂"
                        data-price=100>
                    </button>
                </div>
            </div>
            <div class="col">
                <div class="d-grid gap-2">
                    <button class="itemBtn btn btn-warning" type="button" id="item4Btn" data-stock-name="卡布奇諾"
                        data-price=120>
                    </button>
                </div>
            </div>
        </div>
    </div> -->

    <div class="container">
        <div class="row">
            <div class="col">
                <div class="card" style="width: 19.1rem;">
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211015154053432.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title text-center">拿鐵</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the card's content.</p>
                        <div class="text-center">
                            <a href="https://www.starbucks.com" class="btn btn-primary">
                                <button class="itemBtn btn btn-primary" type="button" id="item1Btn" data-stock-name="拿鐵"
                                    data-price=140>訂購
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card" style="width: 19.2rem;">
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20220627180140248.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title text-center">花茶</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the card's content.</p>
                        <!-- <div class="d-grid gap-2"> -->
                        <div class="text-center">
                            <a href="#" class="btn btn-primary">
                                <button class="itemBtn btn btn-primary" type="button" id="item2Btn" data-stock-name="花茶"
                                    data-price=100>訂購
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card" style="width: 19.2rem;">
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20220610145723363.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title text-center">星冰樂</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the card's content.</p>
                        <div class="text-center">
                            <a href="#" class="btn btn-primary">
                                <button class="itemBtn btn btn-primary" type="button" id="item3Btn"
                                    data-stock-name="星冰樂" data-price=110>訂購
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="card" style="width: 19rem;">
                    <img src="https://www.starbucks.com.tw/common/objects/images/product/20211001110857273.jpg"
                        class="card-img-top" alt="...">
                    <div class="card-body">
                        <h5 class="card-title text-center">卡布奇諾</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the card's content.</p>
                        <div class="text-center">
                            <a href="#" class="btn btn-primary">
                                <button class="itemBtn btn btn-primary" type="button" id="item4Btn"
                                    data-stock-name="卡布奇諾" data-price=120>訂購
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container mt-5 border border-black" id="container-items">
        <div class="item-row row mt-5">
            <div class="col">
                <div class="mb-3">
                    <label class="form-label">商品</label>
                    <input type="text" class="form-control stockName" disabled>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label class="form-label">數量</label>
                    <input type="number" class="form-control numInput">
                </div>
            </div>
            <div class="col">
                <label for="sugarInput" class="form-label">甜度</label>
                <select class="form-select sugerInput" name="sugarInput">
                    <option value="正常" selected>正常</option>
                    <option value="少糖">少糖</option>
                    <option value="半糖">半糖</option>
                    <option value="微糖">微糖</option>
                    <option value="無糖">無糖</option>
                </select>
            </div>
            <div class="col">
                <label for="iceInput" class="form-label">冰塊</label>
                <select class="form-select iceInput" name="iceInput">
                    <option value="正常" selected>正常</option>
                    <option value="少冰">少冰</option>
                    <option value="微冰">微冰</option>
                    <option value="去冰">去冰</option>
                </select>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="psInput" class="form-label">價格</label>
                    <input id="psInput" type="text" class="form-control psInput">
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="psInput" class="form-label">操作</label>
                    <div class="d-grid gap-2">
                        <button class="btn btn-danger delBtnAll" type="button">
                            <i class="fa-solid fa-xmark"></i>&nbsp;&nbsp; 刪除</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row">
            <div class="col">
                <div class="d-grid gap-2">
                    <button class="btn btn-danger" type="button" id="checkBtn">確定新增</button>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col">
                <hr>
                購買明細資料
                <div class="div p-5 border border-black" id="exDiv">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
        integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
        crossorigin="anonymous" referrerpolicy="no-refe.rrer"></script>
    <script>
        $(document).ready(function () {
            const itemBtn = $('.itemBtn')
            const exDiv = $('#exDiv');
            const stockNameAll = $('.stockName');
            const numInput = $('.numInput');
            const sugerInput = $('.sugerInput');
            const iceInput = $('.iceInput');
            const psInput = $('.psInput');

            const checkBtn = $('#checkBtn');
            const containerItems = $('#container-items');
            const delBtnAll = $('.delBtnAll');
            // const delBtn = $('#delBtn');

            let i = 0; //click 第幾個

            // 按鈕名稱
            // $.each(itemBtn, function (indexInArray, valueOfElement) {
            //     let stockName = $(this).attr('data-stock-name');
            //     $(valueOfElement).text(`${stockName}`);
            // });

            // 刪除
            delBtnAll.click(function () {
                // var nickname = prompt('請輸入你的手機號碼','O9XX-XXX-XXX');
                if (!confirm("確定要刪除嗎？")) {
                    return false;
                }

                // 刪除點下 刪除這一'行'
                console.log('delBtn ok');
                console.log('this', this);

                // 看有幾行
                let getLength = $('.item-row').length;
                console.log('getLength', getLength);
                // 超過一行才可以刪除
                if (getLength <= 1) {
                    alert('不可以刪除');
                    return false;
                }

                let nowDelBtn = $(this);
                // 去看一下html 就可以知道要幾次parent 之後console.log
                let nowRow = nowDelBtn.parent().parent().parent().parent();
                // console.log('nowDelBtn', nowDelBtn);
                // console.log('nowRow', nowRow);
                nowRow.remove();
            });

            // 選擇品項
            itemBtn.click(function () {
                let getRowStockName = $('.item-row').first().find('.stockName').val();
                console.log('getRowStockName', getRowStockName);
                console.log('getRowStockName.length', getRowStockName.length);

                // getRowStockName.length == 0 代表商品沒有文字 取代
                // 有文字 clone

                if (getRowStockName.length > 0) {
                    // 抓第一行clone                
                    $('.item-row').first().clone(true).appendTo('#container-items');
                }
                // 抓最後一行 清洗value
                let lastRow = $('.item-row').last();
                // lastRow.find('input').val('');

                let stockName = $(this).attr('data-stock-name');
                console.log('stockName', stockName);
                let dataPrice = $(this).attr('data-price');
                console.log('dataPrice', dataPrice);

                lastRow.find('.stockName').val(stockName);
                lastRow.find('.numInput').val('1');
                lastRow.find('.sugerInput').val('正常');
                lastRow.find('.iceInput').val('正常');
                // lastRow.find('.psInput').val('');
                lastRow.find('.psInput').val(dataPrice);
            });

            // 確定送出
            checkBtn.click(function () {
                // 點擊checkBtn後，先將exDiv購買明細資料清空
                i = 0;
                exDiv.html("");

                // value
                // console.log('stockNameAll first value', stockNameAll.first().val());
                // value.length
                // console.log('stockNameAll first value', stockNameAll.first().val().length);
                if (stockNameAll.first().val().length < 1) {
                    alert('請選擇商品');
                    return false;
                }

                // 下列程式碼只能存取網頁載入的第一個商品名稱，所以捨棄不用
                // $.each(stockNameAll, function (key, value) {
                //     console.log('key', key);
                //     console.log('value', value);
                // })

                let newStockNameAll = $('.stockName');
                $.each(newStockNameAll, function (key, value) {
                    console.log('newkey', key);
                    console.log('newvalue', $(value));


                    // 1.使用parent()逐一向上找到.item-row
                    let closeRow = $(value).parent().parent().parent();
                    console.log('closeRow', closeRow);

                    // 2.接下來使用find()找到每個input欄位 
                    // let name = stockNameAll.val();
                    // let num = numInput.val();
                    // let suger = sugerInput.val();
                    // let ice = iceInput.val();
                    // let ps = psInput.val();
                    i++;
                    let name = closeRow.find('.stockName').val();
                    let num = closeRow.find('.numInput').val();
                    let suger = closeRow.find('.sugerInput').val();
                    let ice = closeRow.find('.iceInput').val();
                    let ps = closeRow.find('.psInput').val();
                    let content = `<p class="text-primary">第${i}項 商品 ${name} ${num}杯 ${suger} ${ice} ${ps}元</p>`;
                    exDiv.append(content);
                })
            });
        });
    </script>
</body>

</html>